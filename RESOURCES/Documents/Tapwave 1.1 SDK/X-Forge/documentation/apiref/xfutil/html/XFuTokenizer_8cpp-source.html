<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>XFuTokenizer.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>XFuTokenizer.cpp</h1><a href="XFuTokenizer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*! \file </span>
00002 <span class="comment"> * X-Forge Util &lt;br&gt;</span>
00003 <span class="comment"> * Copyright 2000-2003 Fathammer Ltd</span>
00004 <span class="comment"> * </span>
00005 <span class="comment"> * \brief   String tokenizer utility</span>
00006 <span class="comment"> * </span>
00007 <span class="comment"> * $Id: XFuTokenizer.cpp,v 1.4 2003/08/12 13:34:08 lars Exp $</span>
00008 <span class="comment"> * $Date: 2003/08/12 13:34:08 $</span>
00009 <span class="comment"> * $Revision: 1.4 $</span>
00010 <span class="comment"> */</span>
00011 
00012 <span class="preprocessor">#include &lt;xfcore/XFcCore.h&gt;</span>
00013 <span class="preprocessor">#include &lt;string.h&gt;</span> <span class="comment">// memcpy</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="XFuTokenizer_8h.html">xfutil/XFuTokenizer.h</a>&gt;</span>
00015 
00016 <span class="comment"></span>
00017 <span class="comment">//! Constructor</span>
<a name="l00018"></a><a class="code" href="classXFuTokenizer.html#a0">00018</a> <span class="comment"></span><a class="code" href="classXFuTokenizer.html#a0">XFuTokenizer::XFuTokenizer</a>() 
00019 { 
00020     <a class="code" href="classXFuTokenizer.html#o0">mData</a> = NULL; 
00021     <a class="code" href="classXFuTokenizer.html#o1">mCount</a>=0; 
00022 }
00023 
00024 <span class="comment"></span>
00025 <span class="comment">//! Destructor</span>
<a name="l00026"></a><a class="code" href="classXFuTokenizer.html#a1">00026</a> <span class="comment"></span><a class="code" href="classXFuTokenizer.html#a1">XFuTokenizer::~XFuTokenizer</a>() 
00027 {
00028     INT32 i;
00029     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classXFuTokenizer.html#o1">mCount</a>; i++) 
00030         <span class="keyword">delete</span>[] <a class="code" href="classXFuTokenizer.html#o0">mData</a>[i]; 
00031     <span class="keyword">delete</span>[] <a class="code" href="classXFuTokenizer.html#o0">mData</a>; 
00032 }
00033 
00034 <span class="comment"></span>
00035 <span class="comment">//! Tokenizes the input string, using the characters in 'separators' as delimiters for tokens</span>
<a name="l00036"></a><a class="code" href="classXFuTokenizer.html#a2">00036</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classXFuTokenizer.html#a2">XFuTokenizer::tokenize</a>(<span class="keyword">const</span> CHAR * aBuffer, <span class="keyword">const</span> CHAR * aSeparators)
00037 {
00038     <span class="comment">// if reusing this tokenizer, clean up old mess:</span>
00039     <span class="keywordflow">if</span> (<a class="code" href="classXFuTokenizer.html#o0">mData</a> != NULL) 
00040     {
00041         INT32 i;
00042         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classXFuTokenizer.html#o1">mCount</a>; i++) 
00043         {
00044             <span class="keyword">delete</span>[] <a class="code" href="classXFuTokenizer.html#o0">mData</a>[i]; 
00045         }
00046         <span class="keyword">delete</span>[] <a class="code" href="classXFuTokenizer.html#o0">mData</a>;
00047         mCount = 0;
00048         <a class="code" href="classXFuTokenizer.html#o0">mData</a> = NULL;
00049     }
00050     <span class="keywordflow">if</span> (aBuffer == NULL) <span class="keywordflow">return</span>;
00051     INT32 sepcount = 0;
00052     <span class="keywordflow">while</span> (aSeparators[sepcount] != 0) sepcount++;
00053 
00054     <span class="comment">// pass 1: mCount tokens</span>
00055 
00056     <a class="code" href="classXFuTokenizer.html#o1">mCount</a> = 1;
00057     INT32 i = 0;
00058     <span class="keywordflow">while</span> (aBuffer[i] != 0) 
00059     {
00060         INT32 j;
00061         <span class="keywordflow">for</span> (j = 0; j &lt; sepcount; j++)
00062         {
00063             <span class="keywordflow">if</span> (aBuffer[i] == aSeparators[j]) 
00064                 <a class="code" href="classXFuTokenizer.html#o1">mCount</a>++;
00065         }
00066         i++;
00067     }
00068     INT32 *offsets = <span class="keyword">new</span> INT32[<a class="code" href="classXFuTokenizer.html#o1">mCount</a> + 1];
00069     <span class="keywordflow">if</span> (offsets == NULL)
00070     {
00071         <a class="code" href="classXFuTokenizer.html#o1">mCount</a>=0;
00072         <span class="keywordflow">return</span>;
00073     }
00074     INT32 *lengths = <span class="keyword">new</span> INT32[<a class="code" href="classXFuTokenizer.html#o1">mCount</a> + 1];
00075     <span class="keywordflow">if</span> (lengths == NULL)
00076     {
00077         <span class="keyword">delete</span>[] offsets;
00078         <a class="code" href="classXFuTokenizer.html#o1">mCount</a>=0;
00079         <span class="keywordflow">return</span>;
00080     }
00081     <a class="code" href="classXFuTokenizer.html#o1">mCount</a>=0;
00082     offsets[0]=0;
00083     i=0;
00084 
00085     <span class="comment">// pass 2: mCount token sizes and offsets</span>
00086 
00087     <span class="keywordflow">while</span> (aBuffer[i] != 0) 
00088     {
00089         INT32 j;
00090         <span class="keywordflow">for</span> (j=0;j&lt;sepcount;j++)
00091         {
00092             <span class="keywordflow">if</span> (aBuffer[i]==aSeparators[j]) 
00093                 offsets[++<a class="code" href="classXFuTokenizer.html#o1">mCount</a>]=i+1;
00094         }
00095         i++;
00096     }
00097     offsets[++<a class="code" href="classXFuTokenizer.html#o1">mCount</a>] = i + 1;
00098 
00099     <span class="comment">// pass 3: trim</span>
00100 
00101     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="classXFuTokenizer.html#o1">mCount</a>; i++) 
00102     {
00103         <span class="comment">// ltrim</span>
00104         <span class="keywordflow">while</span> (aBuffer[offsets[i]] == 32 || aBuffer[offsets[i]] == 9) offsets[i]++;
00105         <span class="comment">// rtrim</span>
00106         lengths[i] = offsets[i + 1] - (offsets[i] + 1);
00107         <span class="keywordflow">while</span> (lengths[i] &gt; 0 &amp;&amp; (aBuffer[offsets[i] + lengths[i] - 1] == 32 || aBuffer[offsets[i] + lengths[i] - 1] == 9)) lengths[i]--;
00108     }
00109 
00110     <span class="comment">// pass 4: allocate</span>
00111 
00112     <a class="code" href="classXFuTokenizer.html#o0">mData</a> = <span class="keyword">new</span> CHAR*[mCount];
00113     <span class="keywordflow">if</span> (<a class="code" href="classXFuTokenizer.html#o0">mData</a> == NULL)
00114     {
00115         <span class="keyword">delete</span>[] offsets;
00116         <span class="keyword">delete</span>[] lengths;
00117         mCount=0;
00118         <span class="keywordflow">return</span>;
00119     }
00120     <span class="keywordflow">for</span> (i = 0; i &lt; mCount; i++) 
00121     {
00122         <a class="code" href="classXFuTokenizer.html#o0">mData</a>[i] = <span class="keyword">new</span> CHAR[lengths[i] + 1];
00123         <a class="code" href="classXFuTokenizer.html#o0">mData</a>[i][lengths[i]] = 0;
00124     }
00125     
00126     <span class="comment">// pass 5: copy tokens</span>
00127 
00128     <span class="keywordflow">for</span> (i = 0; i &lt; mCount; i++)
00129     {
00130         INT32 j, c;
00131         <span class="keywordflow">for</span> (j = offsets[i], c = 0; j &lt; offsets[i] + lengths[i]; j++, c++)
00132         {
00133             <a class="code" href="classXFuTokenizer.html#o0">mData</a>[i][c] = aBuffer[j];
00134         }
00135     }
00136     <span class="keyword">delete</span>[] offsets;
00137     <span class="keyword">delete</span>[] lengths;
00138 }
00139 
00140 <span class="comment"></span>
00141 <span class="comment">//! Tokenizes the input string, using the ',' and '=' characters as delimiters for tokens</span>
<a name="l00142"></a><a class="code" href="classXFuTokenizer.html#a3">00142</a> <span class="comment"></span><span class="keywordtype">void</span> <a class="code" href="classXFuTokenizer.html#a2">XFuTokenizer::tokenize</a>(<span class="keyword">const</span> CHAR * aBuffer)
00143 {
00144     <a class="code" href="classXFuTokenizer.html#a2">tokenize</a>(aBuffer,<span class="stringliteral">"=,"</span>);
00145 }
00146 
00147 <span class="comment"></span>
00148 <span class="comment">//! Case sensitive matching of a token and given string</span>
<a name="l00149"></a><a class="code" href="classXFuTokenizer.html#a4">00149</a> <span class="comment"></span>INT <a class="code" href="classXFuTokenizer.html#a4">XFuTokenizer::tokenEquals</a>(INT32 aIdx, <span class="keyword">const</span> CHAR * aCompareString)
00150 {
00151     <span class="keyword">const</span> CHAR *t1 = <a class="code" href="classXFuTokenizer.html#a7">getToken</a>(aIdx), *t2 = aCompareString;
00152     <span class="keywordflow">while</span> (*t1 != 0 &amp;&amp; *t2 != 0 &amp;&amp; *t1 == *t2) 
00153     { 
00154         t1++; 
00155         t2++; 
00156     }
00157     <span class="keywordflow">if</span> (*t1 == *t2) <span class="keywordflow">return</span> 1;
00158     <span class="keywordflow">return</span> 0;
00159 }
00160 
00161 <span class="comment"></span>
00162 <span class="comment">//! Case insensitive matching of a token and given string</span>
<a name="l00163"></a><a class="code" href="classXFuTokenizer.html#a5">00163</a> <span class="comment"></span>INT <a class="code" href="classXFuTokenizer.html#a5">XFuTokenizer::tokenEqualsNocase</a>(INT32 aIdx, <span class="keyword">const</span> CHAR * aCompareString)
00164 {
00165     <span class="keyword">const</span> CHAR *t1 = <a class="code" href="classXFuTokenizer.html#a7">getToken</a>(aIdx), *t2 = aCompareString;
00166     <span class="keywordflow">while</span> (*t1 != 0 &amp;&amp; *t2 != 0 &amp;&amp; <a class="code" href="classXFuTokenizer.html#c0">upcase</a>(*t1) == <a class="code" href="classXFuTokenizer.html#c0">upcase</a>(*t2)) 
00167     { 
00168         t1++; 
00169         t2++; 
00170     }
00171     <span class="keywordflow">if</span> (*t1 == *t2) <span class="keywordflow">return</span> 1;
00172     <span class="keywordflow">return</span> 0;
00173 }
00174 
00175 <span class="comment"></span>
00176 <span class="comment">//! Get the token count</span>
<a name="l00177"></a><a class="code" href="classXFuTokenizer.html#a6">00177</a> <span class="comment"></span>INT32 <a class="code" href="classXFuTokenizer.html#a6">XFuTokenizer::getTokenCount</a>()
00178 { 
00179     <span class="keywordflow">return</span> <a class="code" href="classXFuTokenizer.html#o1">mCount</a>; 
00180 }
00181 
00182 <span class="comment"></span>
00183 <span class="comment">//! Get a pointer to a token (as zero-terminated string)</span>
<a name="l00184"></a><a class="code" href="classXFuTokenizer.html#a7">00184</a> <span class="comment"></span><span class="keyword">const</span> CHAR * <a class="code" href="classXFuTokenizer.html#a7">XFuTokenizer::getToken</a>(INT32 aIdx)
00185 { 
00186     <span class="keywordflow">return</span> (<span class="keyword">const</span> CHAR*)<a class="code" href="classXFuTokenizer.html#o0">mData</a>[aIdx]; 
00187 }
00188 
00189 <span class="comment"></span>
00190 <span class="comment">//! Get a duplicate of a token (as zero-terminated string)</span>
<a name="l00191"></a><a class="code" href="classXFuTokenizer.html#a8">00191</a> <span class="comment"></span>CHAR * <a class="code" href="classXFuTokenizer.html#a8">XFuTokenizer::duplicateToken</a>(INT32 aIdx) 
00192 { 
00193     INT32 l=0;
00194     <span class="keyword">const</span> CHAR * s=<a class="code" href="classXFuTokenizer.html#o0">mData</a>[aIdx];
00195     <span class="keywordflow">while</span> (s[l]!=0) l++;
00196     CHAR * copy=<span class="keyword">new</span> CHAR[l+1];
00197     copy[l]=<span class="charliteral">'\0'</span>;
00198     memcpy(copy,s,l*<span class="keyword">sizeof</span>(CHAR));
00199     <span class="keywordflow">return</span> copy;
00200 }
00201 
00202 <span class="comment"></span>
00203 <span class="comment">//! upcase function</span>
<a name="l00204"></a><a class="code" href="classXFuTokenizer.html#c0">00204</a> <span class="comment"></span>CHAR <a class="code" href="classXFuTokenizer.html#c0">XFuTokenizer::upcase</a>(CHAR i) 
00205 {
00206     <span class="keywordflow">if</span> (i&gt;=<span class="charliteral">'a'</span> &amp;&amp; i&lt;=<span class="charliteral">'z'</span>) <span class="keywordflow">return</span> (CHAR)(i-(<span class="charliteral">'a'</span>-<span class="charliteral">'A'</span>));
00207     <span class="keywordflow">return</span> i;
00208 }
00209 
00210 
00211 
</pre></div><br clear=all>
<center><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=5><img src="paleblue.gif" width=600 height=1></td></tr>
<tr><td>&nbsp;&nbsp;&nbsp;</td><td><a href="http://www.fathammer.com/"><img src="logo.gif" border=0></a></td>
<td valign=bottom><center><font face="arial, helvetica" size="-2" color="#003366">X-Forge Documentation<br>Confidential<br>Copyright &copy; 2002-2003 Fathammer</font></center></td><td>&nbsp;&nbsp;&nbsp;</td>
<td valign=bottom><center><font face="arial, helvetica" size="-2" color="#003366">Documentation generated<br>with <a href="http://www.doxygen.org/index.html">doxygen</a><br>by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a></font></center></td></tr></table>
</body></html>
